(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{10861:(e,t,n)=>{Promise.resolve().then(n.bind(n,87788))},87788:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(95155),a=n(12115);let s=(0,n(20067).createBrowserClient)("https://zxtdemwfayfbeljechie.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4dGRlbXdmYXlmYmVsamVjaGllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NDkwNTAsImV4cCI6MjA2NjQyNTA1MH0.KXBVcFcSpxOpRUeoR7NV0rRU8EiMj39Oht6ScEVxzJA");function l(e){let{onAuth:t}=e,[n,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)({email:"",password:"",name:"",lesson_number:""}),[u,d]=(0,a.useState)(""),c={padding:10,borderRadius:8,border:"1px solid #ddd"},m=async e=>{if(e.preventDefault(),d(""),n){let{data:e,error:n}=await s.auth.signUp({email:o.email,password:o.password,options:{data:{name:o.name,lesson_number:o.lesson_number}}});if(n)return d(n.message);e.user&&t(e.user)}else{let{data:e,error:n}=await s.auth.signInWithPassword({email:o.email,password:o.password});if(n)return d(n.message);e.user&&t(e.user)}};return(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",background:"#f7fafc"},children:(0,r.jsxs)("form",{onSubmit:m,style:{background:"#fff",borderRadius:16,boxShadow:"0 4px 24px #0001",maxWidth:340,width:"100%",padding:32,display:"flex",flexDirection:"column",gap:16},children:[(0,r.jsx)("h2",{style:{textAlign:"center",color:"#1A2A4F",marginBottom:8},children:n?"Sign Up":"Sign In"}),(0,r.jsx)("input",{name:"email",type:"email",placeholder:"Email",value:o.email,onChange:e=>i({...o,[e.target.name]:e.target.value}),required:!0,style:c}),(0,r.jsx)("input",{name:"password",type:"password",placeholder:"Password",value:o.password,onChange:e=>i({...o,[e.target.name]:e.target.value}),required:!0,style:c}),n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{name:"name",placeholder:"Name",value:o.name,onChange:e=>i({...o,[e.target.name]:e.target.value}),required:!0,style:c}),(0,r.jsx)("input",{name:"lesson_number",placeholder:"Lesson Number",value:o.lesson_number,onChange:e=>i({...o,[e.target.name]:e.target.value}),required:!0,style:c})]}),u&&(0,r.jsx)("div",{style:{color:"red",textAlign:"center"},children:u}),(0,r.jsx)("button",{type:"submit",style:{background:"#FFD600",color:"#1A2A4F",fontWeight:700,border:"none",borderRadius:8,padding:12,marginTop:8,cursor:"pointer",fontSize:16},children:n?"Sign Up":"Sign In"}),(0,r.jsx)("div",{style:{marginTop:8,textAlign:"center"},children:(0,r.jsxs)("span",{children:[n?"Already have an account?":"No account?"," ",(0,r.jsx)("button",{type:"button",onClick:()=>l(!n),style:{background:"none",border:"none",color:"#1A2A4F",fontWeight:600,cursor:"pointer",textDecoration:"underline"},children:n?"Sign In":"Sign Up"})]})})]})})}function o(e){let{user:t,onComplete:n}=e,[l,o]=(0,a.useState)({name:"",lesson_number:""}),[i,u]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),g={padding:10,borderRadius:8,border:"1px solid #ddd"},h=async e=>{e.preventDefault(),u(""),c(!0),p(!1);let{error:r}=await s.from("profiles").upsert({id:t.id,email:t.email,name:l.name,lesson_number:l.lesson_number});if(c(!1),r)return void u(r.message);p(!0),n()};return(0,r.jsxs)("form",{onSubmit:h,style:{maxWidth:340,margin:"auto",padding:32,background:"#fff",borderRadius:16,boxShadow:"0 4px 24px #0001",display:"flex",flexDirection:"column",gap:16},"aria-label":"Profile setup form",children:[(0,r.jsx)("h2",{style:{textAlign:"center",color:"#1A2A4F",marginBottom:8},children:"Complete Your Profile"}),(0,r.jsx)("input",{name:"name",placeholder:"Name",value:l.name,onChange:e=>o({...l,[e.target.name]:e.target.value}),required:!0,style:g,"aria-label":"Name"}),(0,r.jsx)("input",{name:"lesson_number",placeholder:"Lesson Number",value:l.lesson_number,onChange:e=>o({...l,[e.target.name]:e.target.value}),required:!0,style:g,"aria-label":"Lesson Number"}),(0,r.jsxs)("div",{"aria-live":"polite",style:{minHeight:32,margin:"8px 0"},children:[d&&(0,r.jsx)("div",{className:"loader",style:{margin:"0 auto",display:"block"},"aria-label":"Saving..."}),m&&(0,r.jsxs)("div",{style:{color:"green",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[(0,r.jsx)("span",{"aria-hidden":"true",children:"✅"})," ",(0,r.jsx)("span",{children:"Profile saved!"})]}),i&&(0,r.jsxs)("div",{style:{color:"red",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[(0,r.jsx)("span",{"aria-hidden":"true",children:"❌"})," ",(0,r.jsx)("span",{children:i})]})]}),(0,r.jsx)("button",{type:"submit",style:{background:"#FFD600",color:"#1A2A4F",fontWeight:700,border:"none",borderRadius:8,padding:12,marginTop:8,cursor:"pointer",fontSize:16},children:"Save"})]})}var i=n(85411),u=n.n(i);function d(e){let{currentUser:t}=e,n=(0,a.useRef)(null),l=(0,a.useRef)(null),[o,i]=(0,a.useState)([]),[d,c]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{if(n.current&&!l.current)return l.current=new(u()).Map({container:n.current,style:"mapbox://styles/mapbox/light-v11",center:[78,22],zoom:2.2,attributionControl:!1}),l.current.addControl(new(u()).NavigationControl),()=>{var e;return null==(e=l.current)?void 0:e.remove()}},[]),(0,a.useEffect)(()=>{c(!0);let e=async()=>{let{data:e,error:t}=await s.from("locations").select("user_id,latitude,longitude,updated_at,profiles(name,lesson_number)");t?(console.error("Error fetching locations:",t),i([])):i(e||[]),c(!1)};e();let t=s.channel("realtime:locations").on("postgres_changes",{event:"*",schema:"public",table:"locations"},e).subscribe();return()=>{s.removeChannel(t)}},[]),(0,a.useEffect)(()=>{if(!l.current||!n.current)return;let e=l.current,t=[];return console.log("All users:",o),o.forEach(t=>{var n,r,a,s;if(!t||"number"!=typeof t.latitude||"number"!=typeof t.longitude)return void console.warn("Invalid user location, skipping:",t);let l=document.createElement("div");l.style.width="10px",l.style.height="10px",l.style.backgroundColor="blue",l.style.borderRadius="50%",l.style.border="2px solid white";let o=(null==(r=t.profiles)||null==(n=r[0])?void 0:n.name)||"User",i=(null==(s=t.profiles)||null==(a=s[0])?void 0:a.lesson_number)||"N",d=new(u()).Popup({offset:18}).setHTML("<strong>".concat(o,"</strong><br>").concat(i));try{new(u()).Marker({element:l}).setLngLat([t.longitude,t.latitude]).setPopup(d).addTo(e)}catch(e){console.error("Error adding marker:",e)}}),()=>{t.forEach(e=>e.remove()),t=[]}},[o,t]),(0,r.jsxs)("div",{style:{position:"relative",width:"100%",height:"100vh",borderRadius:16,boxShadow:"0 4px 24px #0002",overflow:"hidden",margin:16},"aria-label":"Live user map",children:[d&&(0,r.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10},children:(0,r.jsx)("div",{className:"loader"})}),(0,r.jsx)("div",{ref:n,style:{width:"100%",height:"100%"}})]})}function c(e){let{user:t}=e;return(0,a.useEffect)(()=>{let e;if(!t)return;let n=async e=>{let{latitude:n,longitude:r}=e.coords;await s.from("locations").upsert({user_id:t.id,latitude:n,longitude:r,updated_at:new Date().toISOString()})};return"geolocation"in navigator&&(e=navigator.geolocation.watchPosition(n)),()=>{void 0!==e&&navigator.geolocation.clearWatch(e)}},[t]),null}function m(){let[e,t]=(0,a.useState)(null),[n,i]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{s.auth.getUser().then(e=>{let{data:n}=e;return t((null==n?void 0:n.user)||null)})},[]),(0,a.useEffect)(()=>{e&&s.from("profiles").select("*").eq("id",e.id).single().then(e=>{let{data:t}=e;return i(!!t)})},[e]),e)?n?u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{user:e}),(0,r.jsx)(d,{currentUser:e})]}):(0,r.jsxs)("div",{style:{maxWidth:400,margin:"auto",padding:32,textAlign:"center"},children:[(0,r.jsx)("h2",{children:"Location Sharing Consent"}),(0,r.jsx)("p",{children:"To appear on the global map, please allow location sharing. Your location will be visible to other devotees."}),(0,r.jsxs)("label",{style:{display:"block",margin:"24px 0"},children:[(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>m(e.target.checked)})," I consent to sharing my location"]})]}):(0,r.jsx)(o,{user:e,onComplete:()=>i(!0)}):(0,r.jsx)(l,{onAuth:t})}u().accessToken="pk.eyJ1IjoibGVraGFuYWFsIiwiYSI6ImNtYXVueWtkcjE2eWYybHNoajl4djRjenIifQ.fMSq0yUaL8GySIMzfZUEqQ"}},e=>{var t=t=>e(e.s=t);e.O(0,[240,67,441,684,358],()=>t(10861)),_N_E=e.O()}]);